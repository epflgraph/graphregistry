
SELECT
    institution_id,
    object_type,
    object_id,
    concept_id,

    MAX(CASE WHEN (object_type = 'Person'      AND calculation_type = 'concept detection on biography')
               OR (object_type = 'Course'      AND calculation_type = 'manual mapping on course page description')
               OR (object_type = 'Lecture'     AND calculation_type = 'LLM keyword extraction (bounded)')
               OR (object_type = 'MOOC'        AND calculation_type = 'slide sum-scores aggregation (bounded)')
               OR (object_type = 'Person'      AND calculation_type = 'concept detection on biography')
               OR (object_type = 'Publication' AND calculation_type = 'concept detection on abstract')
               OR (object_type = 'Startup'     AND calculation_type = 'concept detection on startup website')
               OR (object_type = 'Unit'        AND calculation_type = 'concept detection on unit website')
               OR (object_type = 'Widget'      AND calculation_type = 'concept detection on quiz description')
               OR (object_type = 'Category'    AND calculation_type = 'concept sum-scores aggregation (bounded)')
    THEN score END) AS score1,
    
    MAX(CASE WHEN (object_type = 'Person'  AND calculation_type = 'abstract sum-scores aggregation (bounded)')
               OR (object_type = 'Course'  AND calculation_type = 'slide sum-scores aggregation (bounded)')
               OR (object_type = 'Lecture' AND calculation_type = 'slide sum-scores aggregation (bounded)')
               OR (object_type = 'MOOC'    AND calculation_type = 'people sum-scores aggregation (bounded)')
               OR (object_type = 'Unit'    AND calculation_type = 'manual mapping on unit website')
    THEN score END) AS score2,
    
    
    MAX(CASE WHEN (object_type = 'Course' AND calculation_type = 'concept detection on course page description')
               OR (object_type = 'Unit'   AND calculation_type = 'abstract sum-scores aggregation (bounded)')
    THEN score END) AS score3

FROM test_graph_cache.Edges_N_Object_N_Concept_T_UnionAllScores
GROUP BY institution_id, object_type, object_id, concept_id;


SELECT * FROM test_graph_cache.Edges_N_Object_N_Concept_T_UnionAllScores;
